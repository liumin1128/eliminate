{"version":3,"sources":["Box/game.js","Box/index.js","App.js","reportWebVitals.js","index.js"],"names":["randomString","len","$chars","maxPos","length","pwd","i","charAt","Math","floor","random","sleep","t","Promise","resolve","reject","setTimeout","getRandomAnmal","list","Gamer","x","y","init","onDataChange","onScoreChange","onTimeChange","Howler","volume","sound","map","Howl","src","onplayerror","err","this","once","play","onend","start","timeLoop","time","alert","score","getData","data","update","click","o","a","selectIdx","findIndex","select","objIdx","setIn","a2b","touchMove","sx","sy","ex","ey","sId","eId","maxX","maxY","combo","List","m","n","j","animal","push","id","initData","checkStatus","transXYMap","transMaxXYMap","checkLine","row","type","current","p","q","result","getValue","value","idx","loop","next","find","getItem","removeList","s","flatten","unionBy","status","temp","sumMap","undefined","sum","b","ax","getIn","ay","bx","by","abs","getRemoveList","remove","setRemoveStatus","setRemovePosition","getDownList","gamer","useState","setList","setScore","setTime","width","setWidth","useEffect","document","querySelector","offsetWidth","className","onTouchEnd","e","preventDefault","element","changedTouches","target","parseInt","getAttribute","px","pageX","py","pageY","rect","getBoundingClientRect","rx","ry","style","paddingTop","onClick","cls","removed","removing","height","transform","data-x","data-y","animate__tada","backgroundImage","App","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.525fddc2.chunk.js","sourcesContent":["import flatten from \"lodash/flatten\";\nimport unionBy from \"lodash/unionBy\";\nimport { List } from \"immutable\";\nimport { Howl, Howler } from \"howler\";\n\nexport const randomString = (len = 32) => {\n  const $chars = \"ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678\";\n  /** **默认去掉了容易混淆的字符oOLl,9gq,Vv,Uu,I1*** */\n  const maxPos = $chars.length;\n  let pwd = \"\";\n  for (let i = 0; i < len; i += 1) {\n    pwd += $chars.charAt(Math.floor(Math.random() * maxPos));\n  }\n  return pwd;\n};\n\nconst sleep = (t) => new Promise((resolve, reject) => setTimeout(resolve, t));\n\nfunction getRandomAnmal() {\n  const list = [\n    // \"alligator\",\n    \"chicken\",\n    \"frog\",\n    // \"mouse\",\n    \"sea-lion\",\n    \"bear\",\n    \"dog\",\n    // \"hippo\",\n    // \"owl\",\n    // \"sheep\",\n    // \"bull\",\n    // \"duck\",\n    // \"lion\",\n    // \"panda\",\n    // \"snake\",\n    // \"cat\",\n    // \"elephant\",\n    // \"monkey\",\n    // \"pig\",\n    // \"tiger\",\n  ];\n\n  const i = Math.floor(Math.random() * list.length);\n  return list[i];\n}\n\nfunction initData(m, n) {\n  const list = [];\n  for (let i = 0; i < m; i++) {\n    for (let j = 0; j < n; j++) {\n      const animal = getRandomAnmal();\n      list.push({\n        id: randomString(),\n        x: i,\n        y: j,\n        animal,\n        select: false,\n      });\n    }\n  }\n\n  return list;\n}\n\nclass Gamer {\n  constructor(x, y) {\n    this.maxX = x;\n    this.maxY = y;\n  }\n\n  start() {\n    this.score = 0;\n    this.combo = 0;\n    this.time = 30000;\n    this.data = List(initData(this.maxX, this.maxY));\n\n    this.onDataChange(this.data);\n    this.onScoreChange(this.score);\n    this.onTimeChange(this.time);\n    this.checkStatus();\n    this.timeLoop();\n  }\n\n  init = ({ onDataChange, onScoreChange, onTimeChange }) => {\n    Howler.volume(0.5);\n\n    this.sound = {};\n\n    [\"d1\", \"d2\", \"keyboard\"].map((i) => {\n      this.sound[i] = new Howl({\n        src: [\"./audios/\" + i + \".mp3\"],\n        onplayerror: function (err) {\n          this.sound.once(\"unlock\", function () {\n            this.sound.play();\n          });\n        },\n        volume: 0.5,\n        onend: function () {},\n      });\n    });\n\n    this.onDataChange = onDataChange;\n    this.onScoreChange = onScoreChange;\n    this.onTimeChange = onTimeChange;\n\n    this.start();\n  };\n\n  timeLoop = () => {\n    if (this.time > 0) {\n      this.time = this.time - 1000;\n      this.onTimeChange(this.time);\n      setTimeout(() => {\n        this.timeLoop();\n      }, 1000);\n    } else {\n      alert(\"game over, socre:\" + this.score);\n      this.start();\n    }\n  };\n\n  getData = () => {\n    return this.data;\n  };\n\n  update = () => {\n    this.onDataChange(this.data);\n  };\n\n  getRemoveList(data) {\n    const transXYMap = {\n      x: \"y\",\n      y: \"x\",\n    };\n\n    const transMaxXYMap = {\n      x: this.maxX,\n      y: this.maxY,\n    };\n\n    function checkLine(list, row, type) {\n      let p = 0;\n      let q = 0;\n      let result = [];\n\n      function getItem(data) {\n        const item = list.find(\n          (i) => i[type] === data && i[transXYMap[type]] === row\n        );\n\n        return item;\n      }\n\n      function getValue(value) {\n        let x;\n        let y;\n        let idx;\n        if (type === \"x\") {\n          x = value;\n          y = row;\n        }\n        if (type === \"y\") {\n          x = row;\n          y = value;\n        }\n        idx = list.findIndex((i) => i.x === x && i.y === y);\n        return { x, y, idx };\n      }\n\n      let current;\n\n      function loop() {\n        let next = getItem(q);\n\n        if (!next) {\n          current = null;\n          if (q < transMaxXYMap[type] - 1) {\n            q += 1;\n            loop();\n            return;\n          }\n        }\n\n        if (!current) {\n          current = next;\n        }\n\n        if (current.animal !== next.animal) {\n          if (q - 1 - p > 1) {\n            for (let x = p; x <= q - 1; x++) {\n              result.push(getValue(x));\n            }\n          }\n          p = q;\n        }\n\n        if (q === transMaxXYMap[type] - 1) {\n          if (q - p > 1) {\n            for (let x = p; x <= q; x++) {\n              result.push(getValue(x));\n            }\n          }\n          return;\n        }\n\n        if (q < transMaxXYMap[type] - 1) {\n          q += 1;\n          current = next;\n          loop();\n          return;\n        }\n      }\n\n      loop();\n\n      return result;\n    }\n\n    let removeList = [];\n    for (let i = 0; i < this.maxY; i++) {\n      removeList.push(checkLine(data, i, \"x\"));\n    }\n    for (let i = 0; i < this.maxX; i++) {\n      removeList.push(checkLine(data, i, \"y\"));\n    }\n    const s = flatten(removeList);\n    const t = unionBy(s, (i) => i.idx);\n    removeList = t;\n    return removeList;\n  }\n\n  setRemoveStatus(removeList, status) {\n    let temp = this.data;\n    removeList.map(({ idx }) => {\n      temp = temp.setIn([idx, \"status\"], status);\n    });\n    return temp;\n  }\n\n  setRemovePosition(removeList) {\n    let temp = this.data;\n    let sumMap = {};\n    removeList.map(({ idx, x, y }) => {\n      if (sumMap[x] === undefined) {\n        sumMap[x] = -1;\n      } else {\n        sumMap[x] = sumMap[x] - 1;\n      }\n      temp = temp\n        .setIn([idx, \"y\"], sumMap[x])\n        // .setIn([idx, \"remove\"], false)\n        .setIn([idx, \"animal\"], getRandomAnmal());\n    });\n    return temp;\n  }\n\n  getDownList() {\n    let temp = this.data;\n    for (let x = 0; x < this.maxX; x++) {\n      let sum = 0;\n      for (let y = -this.maxY; y < this.maxY; y++) {\n        const idx = this.data.findIndex((i) => i.x === x && i.y === y);\n        if (idx !== -1) {\n          temp = temp.setIn([idx, \"y\"], sum);\n          sum++;\n        }\n      }\n    }\n    this.data = temp;\n  }\n\n  a2b(a, b) {\n    const ax = this.data.getIn([a, \"x\"]);\n    const ay = this.data.getIn([a, \"y\"]);\n    const bx = this.data.getIn([b, \"x\"]);\n    const by = this.data.getIn([b, \"y\"]);\n\n    // 如果不是水平方向平移一位\n    if (Math.abs(ax - bx) + Math.abs(ay - by) != 1) {\n      return;\n    }\n\n    const temp = this.data\n      .setIn([a, \"x\"], bx)\n      .setIn([a, \"y\"], by)\n      .setIn([b, \"x\"], ax)\n      .setIn([b, \"y\"], ay);\n\n    const removeList = this.getRemoveList(temp);\n    if (removeList.length > 0) {\n      this.data = temp;\n      this.remove(removeList);\n    }\n  }\n\n  click = async (o) => {\n    this.sound[\"keyboard\"].play();\n\n    const selectIdx = this.data.findIndex((i) => i.select);\n    const objIdx = this.data.findIndex((i) => i.x === o.x && i.y === o.y);\n    if (selectIdx != -1) {\n      if (selectIdx === objIdx) {\n        this.data = this.data.setIn([objIdx, \"select\"], false);\n      } else {\n        this.a2b(selectIdx, objIdx);\n        this.data = this.data.setIn([selectIdx, \"select\"], false);\n      }\n      // setList(a2b(this.data, selectIdx, objIdx).setIn([selectIdx, \"select\"], false));\n    } else {\n      this.data = this.data.setIn([objIdx, \"select\"], true);\n    }\n    this.update();\n    // this.checkStatus();\n  };\n\n  touchMove = async (sx,sy,ex,ey) => {\n    const sId = this.data.findIndex((i) => i.x === sx && i.y === sy);\n    const eId = this.data.findIndex((i) => i.x === ex && i.y === ey);\n\n    this.a2b(sId, eId);\n    this.update();\n  }\n\n  async remove(removeList) {\n    this.sound[\"d1\"].play();\n\n    this.score = this.score + removeList.length * this.combo * 100;\n    this.onScoreChange(this.score);\n    this.time = this.time + 1000;\n    if (this.time > 30000) {\n      this.time = 30000;\n    }\n    this.onTimeChange(this.time);\n\n    this.data = this.setRemoveStatus(removeList, \"removing\");\n    this.update();\n\n    await sleep(1000);\n    this.data = this.setRemoveStatus(removeList, \"removed\");\n    this.update();\n\n    await sleep(30);\n    this.data = this.setRemovePosition(removeList);\n    this.update();\n\n    await sleep(30);\n    this.data = this.setRemoveStatus(removeList, \"ok\");\n    this.update();\n\n    await sleep(30);\n    this.getDownList();\n    this.update();\n\n    await sleep(300);\n    this.checkStatus();\n  }\n\n  async checkStatus() {\n    const removeList = this.getRemoveList(this.data);\n    if (removeList.length === 0) return; // 检查是否有需要更新的方块\n\n    // 重新计算移除组\n    if (removeList.length === 0) {\n      // 重置连击数\n      this.combo = 0;\n      return;\n    }\n\n    // 累计连击数\n    this.combo = this.combo + 1;\n    await this.remove(removeList);\n  }\n}\n\nexport default Gamer;\n","import React, { useState, useEffect } from \"react\";\nimport cls from \"classnames\";\nimport Gamer from \"./game\";\nimport \"animate.css\";\nimport \"./index.css\";\n\nconst m = 9;\nconst n = 9;\n\nconst gamer = new Gamer(m, n);\n\nexport default () => {\n  const [list, setList] = useState(null);\n  const [score, setScore] = useState(0);\n  const [time, setTime] = useState(0);\n  const [width, setWidth] = useState(0);\n\n  useEffect(() => {\n\n\n\n    setWidth(document.querySelector(\".root\").offsetWidth / m);\n  }, []);\n\n  function handleClick(o) {\n    gamer.click(o);\n  }\n\n  function handleTouchStart(e) {\n    e.preventDefault();\n  }\n\n  function handleTouchEnd(e) {\n    e.preventDefault();\n    const element = e.changedTouches[0].target\n    const sx = parseInt(element.getAttribute(\"data-x\"),0)\n    const sy = parseInt(element.getAttribute(\"data-y\"),0)\n    // 获取触摸结束点相对于屏幕位置\n    const px= e.changedTouches[0].pageX\n    const py= e.changedTouches[0].pageY\n\n    // 获取画布位置\n    const rect = document.querySelector(\".list\").getBoundingClientRect()\n    const rx = rect.x \n    const ry = rect.y\n\n    // 对比触摸点与画布位置获取坐标\n    const ex = Math.floor((px - rx) / width)\n    const ey = Math.floor((py - ry) / width)\n\n    gamer.touchMove(sx,sy,ex,ey)\n\n  }\n\n  function start() {\n    gamer.init({\n      onDataChange: setList,\n      onScoreChange: setScore,\n      onTimeChange: setTime,\n    });\n  }\n\n  return (\n    <div className=\"root\">\n      {list ? (\n        <>\n          <div className=\"header\">\n            <h1>Score: {score}</h1>\n            <h1>Time: {time / 1000}</h1>\n          </div>\n\n          <div\n            className=\"list\"\n            onTouchEnd={handleTouchEnd}\n            style={{ paddingTop: (n / m) * 100 + \"%\" }}\n          >\n            {list.map((i) => {\n              return (\n                <div\n                  onClick={() => {\n                    handleClick(i);\n                  }}\n                  className={cls([\n                    \"item\",\n                    {\n                      select: i.select,\n                      removed: i.status === \"removed\",\n                      removing: i.status === \"removing\",\n                    },\n                  ])}\n                  key={i.id}\n                  style={{\n                    width: width,\n                    height: width,\n                    transform:\n                      \"translate3d(\" +\n                      i.x * width +\n                      \"px,\" +\n                      i.y * width +\n                      \"px,0)\",\n                  }}\n                >\n                  <div\n                    data-x={i.x}\n                    data-y={i.y}\n                    className={cls([\n                      \"icon\",\n                      \"animate__animated\",\n                      {\n                        animate__tada: i.status === \"removing\",\n                      },\n                    ])}\n                    key={i.id}\n                    style={{\n                      width: width,\n                      height: width,\n                      backgroundImage: \"url(./images/\" + i.animal + \".svg)\",\n                    }}\n                  >\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        </>\n      ) : (\n        <div>\n          <div></div>\n          <div className=\"start\" onClick={start}>\n            START\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n","import './App.css';\nimport Box from './Box'\n\nfunction App() {\n  return (\n    <div className=\"App\">\n      <Box></Box>\n    </div>\n  );\n}\n\nexport default App;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}